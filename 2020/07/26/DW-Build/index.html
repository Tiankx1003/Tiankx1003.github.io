<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="数仓环境搭建"><meta name="keywords" content="BigData,Data-Warehouse,Linux"><meta name="author" content="Tiankx"><meta name="copyright" content="Tiankx"><title>数仓环境搭建 | Tiankx</title><link rel="shortcut icon" href="/fire.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Tiankx" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS-6-8-minimal"><span class="toc-text">CentOS 6.8 minimal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hadoop"><span class="toc-text">Hadoop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zookeeper"><span class="toc-text">Zookeeper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flume"><span class="toc-text">Flume</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka"><span class="toc-text">Kafka</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HBase"><span class="toc-text">HBase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis"><span class="toc-text">Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL"><span class="toc-text">MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-HA"><span class="toc-text">MySQL HA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive"><span class="toc-text">Hive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tez"><span class="toc-text">Tez</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spark"><span class="toc-text">Spark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ElasticSearch"><span class="toc-text">ElasticSearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Canal"><span class="toc-text">Canal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Phoenix"><span class="toc-text">Phoenix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flink"><span class="toc-text">Flink</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sqoop"><span class="toc-text">Sqoop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Azkaban"><span class="toc-text">Azkaban</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Oozie"><span class="toc-text">Oozie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Presto"><span class="toc-text">Presto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Druid"><span class="toc-text">Druid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Impala"><span class="toc-text">Impala</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kylin"><span class="toc-text">Kylin</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/header.jpg"></div><div class="author-info__name text-center">Tiankx</div><div class="author-info__description text-center">Tiankx的个人博客</div><div class="follow-button"><a href="https://github.com/Tiankx1003" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">17</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">8</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://molunerfinn.com" target="_blank" rel="noopener">Molunerfinn</a><a class="author-info-links__name text-center" href="https://kinomin.github.io" target="_blank" rel="noopener">KinoMin</a><a class="author-info-links__name text-center" href="https://molunerfinn.com/hexo-theme-melody-doc" target="_blank" rel="noopener">HexoMelody</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/bg.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tiankx</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">数仓环境搭建</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-07-26</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="CentOS-6-8-minimal"><a href="#CentOS-6-8-minimal" class="headerlink" title="CentOS 6.8 minimal"></a>CentOS 6.8 minimal</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y vim tar rsync openssh openssh-clients libaio net-tools</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设置IP 主机名 hosts 关闭防火墙</span></span><br><span class="line">service iptables stop</span><br><span class="line">chkconfig iptables off</span><br><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">192.168.2.100 hadoop100</span><br><span class="line">192.168.2.102 hadoop102</span><br><span class="line">192.168.2.103 hadoop103</span><br><span class="line">192.168.2.104 hadoop104</span><br><span class="line">192.168.2.104 hadoop104</span><br><span class="line">192.168.2.105 hadoop105</span><br><span class="line">192.168.2.106 hadoop106</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">###新建用户授权</span></span><br><span class="line">useradd tian</span><br><span class="line">passwd tian</span><br><span class="line">vim /etc/sudoer</span><br><span class="line"><span class="comment">#tian ALL=(ALL)    NOPASSWD:ALL</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mkdir /opt/module</span><br><span class="line">sudo mkdir /opt/software</span><br><span class="line"><span class="comment">#安装软件配置环境变量</span></span><br><span class="line">sudo chown tian:tian /opt/module/ /opt/software -R</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#编写同步脚本和免密连接配置文件</span></span><br><span class="line">vim /home/tian/bin/xsync</span><br><span class="line">vim /home/tian/bin/copy-ssh</span><br><span class="line">vim /home/tian/bin/xcall</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pcount=<span class="variable">$#</span></span><br><span class="line"><span class="keyword">if</span> ((pcount==0)); <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> no args;</span><br><span class="line"><span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">p1=<span class="variable">$1</span></span><br><span class="line">fname=`basename <span class="variable">$p1</span>`</span><br><span class="line"><span class="built_in">echo</span> fname=<span class="variable">$fname</span></span><br><span class="line">pdir=`<span class="built_in">cd</span> -P $(dirname <span class="variable">$p1</span>); <span class="built_in">pwd</span>`</span><br><span class="line"><span class="built_in">echo</span> pdir=<span class="variable">$pdir</span></span><br><span class="line">user=`whoami`</span><br><span class="line"><span class="keyword">for</span>((host=102; host&lt;104; host++)); </span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"\033[31m ------------ hadoop<span class="variable">$host</span> ------------ \033[0m"</span></span><br><span class="line">	rsync -av <span class="variable">$pdir</span>/<span class="variable">$fname</span> <span class="variable">$user</span>@hadoop<span class="variable">$host</span>:<span class="variable">$pdir</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ssh-keygen</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hadoop102 hadoop103 hadoop104</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"\033[31m ======== <span class="variable">$i</span> ======== \033[0m"</span></span><br><span class="line">    ssh-copy-id <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="comment"># xcall jps</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hadoop102 hadoop103 hadoop104</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[31m ---------- <span class="variable">$i</span> ---------- \033[0m"</span></span><br><span class="line">        ssh <span class="variable">$i</span> <span class="string">"$*"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Clone Server</span></span><br><span class="line">vim /etc/udev/rules.d/70-persistent-net.rules</span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">vim /etc/sysconfig/network <span class="comment">#修改主机名</span></span><br></pre></td></tr></table></figure>
<p><em>配置多个节点之间的免密连接</em></p>
<h3 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim core-site.xml</span><br><span class="line">vim hdfs-site.xml</span><br><span class="line">vi yarn-site.xml </span><br><span class="line">cp mapred-site.xml.template mapred-site.xml</span><br><span class="line">vim mapred-site.xml</span><br><span class="line"></span><br><span class="line">vim /opt/module/hadoop-2.7.2/etc/hadoop/slaves</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- core-site.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/hadoop-2.7.2/data/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hdfs-site.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:50090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- yarn-site.xml  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置日志聚集 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>604800<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mapred-site.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置历史服务器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br></pre></td></tr></table></figure>
<ul>
<li>该文件中添加的内容结尾不允许有空格，文件中不允许有空行</li>
<li>集群上分发配置</li>
</ul>
<p><strong>群起集群</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#第一次启动集群时需要格式化namenode</span></span><br><span class="line">bin/hdfs namenode -format <span class="comment">#102</span></span><br><span class="line"><span class="comment">#启动HDFS</span></span><br><span class="line">sbin/start-dfs.sh <span class="comment">#102</span></span><br><span class="line"><span class="comment">#启动历史服务器</span></span><br><span class="line">sbin/mr-jobhistory-daemon.sh start historyserver</span><br><span class="line"><span class="comment">#启动YARN</span></span><br><span class="line">sbin/start-yarn.sh <span class="comment">#103</span></span><br><span class="line">jpsall <span class="comment">#查看所有进程</span></span><br></pre></td></tr></table></figure>
<p><a href="http://hadoop104:50090/status.html" target="_blank" rel="noopener">Web端查看SecondaryNameNode</a>.<br><a href="http://tian:50070/dfshealth.html#tab-overview" target="_blank" rel="noopener">web端查看HDFS文件系统</a><br><a href="http://hadoop103:8088/cluster" target="_blank" rel="noopener">Web页面查看YARN</a><br><a href="http://hadoop102:19888/jobhistory" target="_blank" rel="noopener">查看JobHistory</a><br><a href="http://hadoop103:19888/jobhistory" target="_blank" rel="noopener">Web查看日志</a></p>
<h3 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h3><p><strong>安装部署</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/</span><br><span class="line"><span class="comment">### 配置服务器编号</span></span><br><span class="line">mkdir -p zkData</span><br><span class="line">vi myid <span class="comment"># 在文件中添加与server对应的编号：</span></span><br><span class="line">xsync myid <span class="comment"># 并分别在hadoop102、hadoop103上修改myid</span></span><br><span class="line">mv zoo_sample.cfg zoo.cfg</span><br><span class="line">vim zoo.cfg</span><br><span class="line">xsync zoo.cfg</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 修改数据存储路径配置</span><br><span class="line">dataDir&#x3D;&#x2F;opt&#x2F;module&#x2F;zookeeper&#x2F;zkData</span><br><span class="line"># 增加如下配置</span><br><span class="line">#######################cluster##########################</span><br><span class="line">server.1&#x3D;hadoop102:2888:3888</span><br><span class="line">server.2&#x3D;hadoop103:2888:3888</span><br><span class="line">server.3&#x3D;hadoop104:2888:3888</span><br></pre></td></tr></table></figure>

<p><strong>启停测试</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/zkServer.sh start</span><br><span class="line">jps</span><br><span class="line"><span class="comment"># QuorumPeerMain</span></span><br><span class="line">bin/zkServer.sh status</span><br><span class="line">bin/zkCli.sh</span><br><span class="line">quit</span><br><span class="line">bin/zkServer.sh stop</span><br></pre></td></tr></table></figure>

<h3 id="Flume"><a href="#Flume" class="headerlink" title="Flume"></a>Flume</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf apache-flume-1.7.0-bin.tar.gz -C ../module/</span><br><span class="line">mv apache-flume-1.7.0-bin flume</span><br><span class="line">mv flume-env.sh.template flume-env.sh</span><br><span class="line">vim flume-env.sh</span><br><span class="line"><span class="comment"># export JAVA_HOME=/opt/module/jdk1.8.0_144</span></span><br></pre></td></tr></table></figure>

<h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf kafka_2.11-0.11.0.0.tgz -C /opt/module/</span><br><span class="line">mv kafka_2.11-0.11.0.0/ kafka</span><br><span class="line">mkdir logs</span><br><span class="line"><span class="built_in">cd</span> config/</span><br><span class="line">vim server.properties</span><br><span class="line">xsync /opt/module/kafka/ <span class="comment"># 分发后配置其他节点环境变量</span></span><br><span class="line"><span class="comment"># 修改其他节点server.properties中的brokerid为1和2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#broker的全局唯一编号，不能重复</span></span><br><span class="line"><span class="meta">broker.id</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#删除topic功能使能</span></span><br><span class="line"><span class="meta">delete.topic.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#处理网络请求的线程数量</span></span><br><span class="line"><span class="meta">num.network.threads</span>=<span class="string">3</span></span><br><span class="line"><span class="comment">#用来处理磁盘IO的现成数量</span></span><br><span class="line"><span class="meta">num.io.threads</span>=<span class="string">8</span></span><br><span class="line"><span class="comment">#发送套接字的缓冲区大小</span></span><br><span class="line"><span class="meta">socket.send.buffer.bytes</span>=<span class="string">102400</span></span><br><span class="line"><span class="comment">#接收套接字的缓冲区大小</span></span><br><span class="line"><span class="meta">socket.receive.buffer.bytes</span>=<span class="string">102400</span></span><br><span class="line"><span class="comment">#请求套接字的缓冲区大小</span></span><br><span class="line"><span class="meta">socket.request.max.bytes</span>=<span class="string">104857600</span></span><br><span class="line"><span class="comment">#kafka运行日志存放的路径	</span></span><br><span class="line"><span class="meta">log.dirs</span>=<span class="string">/opt/module/kafka/logs</span></span><br><span class="line"><span class="comment">#topic在当前broker上的分区个数</span></span><br><span class="line"><span class="meta">num.partitions</span>=<span class="string">1</span></span><br><span class="line"><span class="comment">#用来恢复和清理data下数据的线程数量</span></span><br><span class="line"><span class="meta">num.recovery.threads.per.data.dir</span>=<span class="string">1</span></span><br><span class="line"><span class="comment">#segment文件保留的最长时间，超时将被删除</span></span><br><span class="line"><span class="meta">log.retention.hours</span>=<span class="string">168</span></span><br><span class="line"><span class="comment">#配置连接Zookeeper集群地址</span></span><br><span class="line"><span class="meta">zookeeper.connect</span>=<span class="string">hadoop102:2181,hadoop103:2181,hadoop104:2181</span></span><br></pre></td></tr></table></figure>
<p><strong>启停测试</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动集群，先开zookeeper</span></span><br><span class="line">kafka-server-start.sh -daemon config/server.properties <span class="comment"># 在每个节点执行</span></span><br><span class="line"><span class="comment"># 关闭集群，先关zookeeper</span></span><br><span class="line">kafka-server-stop.sh <span class="comment"># 在每个节点执行</span></span><br></pre></td></tr></table></figure>

<h3 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动zk hadoop</span></span><br><span class="line">tar -zxvf hbase-1.3.1-bin.tar.gz -C /opt/module</span><br><span class="line">vim hbase-env.sh</span><br><span class="line">vim hbase-site.xml</span><br><span class="line">vim regionservers</span><br><span class="line">mv hbase-1.3.1/ hbase/</span><br><span class="line"><span class="comment"># 软链接hadoop配置文件到hbase,每个节点配置了hadoop环境变量可以省略这一步</span></span><br><span class="line">ln -s /opt/module/hadoop-2.7.2/etc/hadoop/core-site.xml /opt/module/hbase/conf/core-site.xml</span><br><span class="line">ln -s /opt/module/hadoop-2.7.2/etc/hadoop/hdfs-site.xml /opt/module/hbase/conf/hdfs-site.xml</span><br><span class="line">xsync /opt/module/hbase/ <span class="comment"># 分发配置</span></span><br><span class="line"><span class="comment"># 启停</span></span><br><span class="line">hbase-daemon.sh start master</span><br><span class="line">hbase-daemon.sh start regionserver</span><br><span class="line">start-hbase.sh <span class="comment"># 启动方法二</span></span><br><span class="line">stop-hbase.sh</span><br><span class="line">hbase shell <span class="comment"># 启动交互</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">export</span> <span class="string">JAVA_HOME=/opt/module/jdk1.8.0_144</span></span><br><span class="line"><span class="attr">export</span> <span class="string">HBASE_MANAGES_ZK=false</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span>     </span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>     </span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 0.98后的新变动，之前版本没有.port,默认端口为60000 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>16000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	     <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102,hadoop103,hadoop104<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	     <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/zookeeper/zkData<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br></pre></td></tr></table></figure>

<p><a href="http://hadoop102:16010" target="_blank" rel="noopener">hbase页面</a></p>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zcvf file.tar.gz -C /opt/module <span class="comment">#解压</span></span><br><span class="line">yum -y install gcc-c++ <span class="comment">#安装gcc编译器</span></span><br><span class="line">make <span class="comment">#编译</span></span><br><span class="line">make install <span class="comment">#安装在/usr/local/bin</span></span><br><span class="line">vim /etc/profile <span class="comment">#配置环境变量</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">bind</span> <span class="string">192.168.2.102</span></span><br><span class="line"><span class="meta">protected-mode</span> <span class="string">no</span></span><br><span class="line"><span class="attr">port</span> <span class="string">6379</span></span><br><span class="line"><span class="meta">tcp-backlog</span> <span class="string">511</span></span><br><span class="line"><span class="attr">timeout</span> <span class="string">0</span></span><br><span class="line"><span class="meta">tcp-keepalive</span> <span class="string">300</span></span><br><span class="line"><span class="attr">daemonize</span> <span class="string">yes</span></span><br><span class="line"><span class="attr">supervised</span> <span class="string">no</span></span><br><span class="line"><span class="attr">pidfile</span> <span class="string">/var/run/redis_6379.pid</span></span><br><span class="line"><span class="attr">loglevel</span> <span class="string">notice</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">""</span></span><br><span class="line"><span class="attr">databases</span> <span class="string">16</span></span><br><span class="line"><span class="attr">save</span> <span class="string">900 1 </span></span><br><span class="line"><span class="attr">save</span> <span class="string">300 10</span></span><br><span class="line"><span class="attr">save</span> <span class="string">60 10000</span></span><br></pre></td></tr></table></figure>

<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -qa|grep mysql <span class="comment">#查看当前mysql的安装情况</span></span><br><span class="line">sudo rpm -e --nodeps mysql-libs-5.1.73-8.el6_8.x86_64 <span class="comment">#卸载之前的mysql</span></span><br><span class="line">sudo rpm -ivh MySQL-client-5.6.24-1.el6.x86_64.rpm <span class="comment">#在包所在的目录中安装</span></span><br><span class="line">sudo rpm -ivh MySQL-server-5.6.24-1.el6.x86_64.rpm</span><br><span class="line">mysqladmin --version <span class="comment">#查看mysql版本</span></span><br><span class="line">rpm -qa|grep MySQL <span class="comment">#查看mysql是否安装完成</span></span><br><span class="line">sudo service mysql restart <span class="comment"># 重启服务</span></span><br><span class="line">cat /root/.mysql_secret</span><br><span class="line">mysqladmin -u root password <span class="comment">#设置密码,需要先启动服务</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改密码</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="keyword">PASSWORD</span>(<span class="string">'root'</span>);</span><br><span class="line"><span class="comment">## MySQL在user表中主机配置</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"><span class="keyword">use</span> mysql;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line">desc user;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">User</span>, Host, <span class="keyword">Password</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="comment"># 修改user表，把Host表内容修改为%</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host=<span class="string">'%'</span> <span class="keyword">where</span> host=<span class="string">'localhost'</span>;</span><br><span class="line"><span class="comment"># 删除root中的其他账户</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> Host=<span class="string">'hadoop101'</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> Host=<span class="string">'127.0.0.1'</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> Host=<span class="string">'::1'</span>;</span><br><span class="line"><span class="comment"># 刷新</span></span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br><span class="line">\q;</span><br></pre></td></tr></table></figure>

<h3 id="MySQL-HA"><a href="#MySQL-HA" class="headerlink" title="MySQL HA"></a>MySQL HA</h3><ul>
<li>如果Hive元数据配置到了MySQL，需要更改hive-site.xml中javax.jdo.option.ConnectionURL为虚拟ip</li>
</ul>
<p><strong>一主一从</strong><br>| hadoop102 | hadoop103 | hadoop104 |<br>| :——– | :——– | :——– |<br>| Master    | Slave     |           |</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改hadoop102中MySQL的/usr/my.cnf配置文件</span></span><br><span class="line">sudo vim /usr/my.cnf </span><br><span class="line">sudo service mysql restart</span><br><span class="line">mysql -uroot -proot</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#开启binlog</span></span><br><span class="line"><span class="attr">log_bin</span> = <span class="string">mysql-bin</span></span><br><span class="line"><span class="comment">#MySQL服务器唯一id</span></span><br><span class="line"><span class="attr">server_id</span> = <span class="string">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">master</span> <span class="keyword">status</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改hadoop103中MySQL的/usr/my.cnf配置文件</span></span><br><span class="line">sudo vim /usr/my.cnf</span><br><span class="line">sudo service mysql restart</span><br><span class="line">mysql -uroot -proot</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#MySQL服务器唯一id</span></span><br><span class="line"><span class="attr">server_id</span> = <span class="string">2</span></span><br><span class="line"><span class="comment">#开启slave中继日志</span></span><br><span class="line"><span class="meta">relay-log</span>=<span class="string">mysql-relay</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CHANGE</span> <span class="keyword">MASTER</span> <span class="keyword">TO</span> </span><br><span class="line">MASTER_HOST=<span class="string">'hadoop102'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'root'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'root'</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-bin.000001'</span>,</span><br><span class="line">MASTER_LOG_POS=<span class="number">120</span>; <span class="comment">-- 根据position设置</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span> \G;</span><br></pre></td></tr></table></figure>
<p><strong>双主</strong><br>| hadoop102     | hadoop103     | hadoop104 |<br>| :———— | :———— | :——– |<br>| Master(Slave) | Slave(Master) |           |</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hadoop102</span></span><br><span class="line">sudo vim /usr/my.cnf</span><br><span class="line">sudo service mysql restart</span><br><span class="line">mysql -uroot -proot</span><br><span class="line"><span class="comment"># show master status;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#开启binlog</span></span><br><span class="line"><span class="attr">log_bin</span> = <span class="string">mysql-bin</span></span><br><span class="line"><span class="comment">#MySQL服务器唯一id</span></span><br><span class="line"><span class="attr">server_id</span> = <span class="string">2</span></span><br><span class="line"><span class="comment">#开启slave中继日志</span></span><br><span class="line"><span class="meta">relay-log</span>=<span class="string">mysql-relay</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hadoop103</span></span><br><span class="line">sudo vim /usr/my.cnf</span><br><span class="line">sudo service mysql restart</span><br><span class="line">mysql -uroot -proot</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#MySQL服务器唯一id</span></span><br><span class="line"><span class="attr">server_id</span> = <span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#开启binlog</span></span><br><span class="line"><span class="attr">log_bin</span> = <span class="string">mysql-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#开启slave中继日志</span></span><br><span class="line"><span class="meta">relay-log</span>=<span class="string">mysql-relay</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CHANGE</span> <span class="keyword">MASTER</span> <span class="keyword">TO</span> </span><br><span class="line">MASTER_HOST=<span class="string">'hadoop102'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'root'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'root'</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-bin.000001'</span>,</span><br><span class="line">MASTER_LOG_POS=<span class="number">107</span>;</span><br></pre></td></tr></table></figure>
<p><strong>两个节点安装配置Keepalived</strong></p>
<ul>
<li>hadoop102</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install -y keepalived</span><br><span class="line">sudo chkconfig keepalived on</span><br><span class="line">sudo vim /etc/keepalived/keepalived.conf</span><br><span class="line">sudo vim /var/lib/mysql/keepalived.sh</span><br><span class="line">sudo keepalived start</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">! Configuration File for keepalived</span></span><br><span class="line"><span class="attr">global_defs</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">router_id</span> <span class="string">MySQL-ha</span></span><br><span class="line"><span class="attr">&#125;</span></span><br><span class="line"><span class="attr">vrrp_instance</span> <span class="string">VI_1 &#123;</span></span><br><span class="line">    <span class="attr">state</span> <span class="string">master #初始状态</span></span><br><span class="line">    <span class="attr">interface</span> <span class="string">eth0 #网卡</span></span><br><span class="line">    <span class="attr">virtual_router_id</span> <span class="string">51 #虚拟路由id</span></span><br><span class="line">    <span class="attr">priority</span> <span class="string">100 #优先级</span></span><br><span class="line">    <span class="attr">advert_int</span> <span class="string">1 #Keepalived心跳间隔</span></span><br><span class="line">    <span class="attr">nopreempt</span> <span class="string">#只在高优先级配置，原master恢复之后不重新上位</span></span><br><span class="line">    <span class="attr">authentication</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">auth_type</span> <span class="string">PASS #认证相关</span></span><br><span class="line">        <span class="attr">auth_pass</span> <span class="string">1111</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line">    <span class="attr">virtual_ipaddress</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="meta">192.168.1.100</span> <span class="string">#虚拟ip</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="meta">&#125;</span> <span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#声明虚拟服务器</span></span><br><span class="line"><span class="attr">virtual_server</span> <span class="string">192.168.2.100 3306 &#123;</span></span><br><span class="line">    <span class="attr">delay_loop</span> <span class="string">6</span></span><br><span class="line">    <span class="attr">persistence_timeout</span> <span class="string">30</span></span><br><span class="line">    <span class="attr">protocol</span> <span class="string">TCP</span></span><br><span class="line"><span class="comment">    #声明真实服务器</span></span><br><span class="line">    <span class="attr">real_server</span> <span class="string">192.168.2.102 3306 &#123;</span></span><br><span class="line">        <span class="attr">notify_down</span> <span class="string">/var/lib/mysql/killkeepalived.sh #真实服务故障后调用脚本</span></span><br><span class="line">        <span class="attr">TCP_CHECK</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="attr">connect_timeout</span> <span class="string">3 #超时时间</span></span><br><span class="line">            <span class="attr">nb_get_retry</span> <span class="string">1 #重试次数</span></span><br><span class="line">            <span class="attr">delay_before_retry</span> <span class="string">1 #重试时间间隔</span></span><br><span class="line">        <span class="attr">&#125;</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">sudo service keepalived stop</span><br></pre></td></tr></table></figure>

<ul>
<li>hadoop103</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install -y keepalived</span><br><span class="line">sudo chkconfig keepalived on</span><br><span class="line">sudo vim /etc/keepalived/keepalived.conf</span><br><span class="line">sudo vim /var/lib/mysql/killkeepalived.sh</span><br><span class="line">sudo service keepalived start</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id MySQL-ha</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state master #初始状态</span><br><span class="line">    interface eth0 #网卡</span><br><span class="line">    virtual_router_id 51 #虚拟路由id</span><br><span class="line">    priority 100 #优先级</span><br><span class="line">    advert_int 1 #Keepalived心跳间隔</span><br><span class="line">    nopreempt #只在高优先级配置，原master恢复之后不重新上位</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS #认证相关</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.2.100 #虚拟ip</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">#声明虚拟服务器</span><br><span class="line">virtual_server 192.168.1.100 3306 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    persistence_timeout 30</span><br><span class="line">    protocol TCP</span><br><span class="line">    #声明真实服务器</span><br><span class="line">    real_server 192.168.2.103 3306 &#123;</span><br><span class="line">        notify_down &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;killkeepalived.sh #真实服务故障后调用脚本</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 3 #超时时间</span><br><span class="line">            nb_get_retry 1 #重试次数</span><br><span class="line">            delay_before_retry 1 #重试时间间隔</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">sudo service keepalived stop</span><br></pre></td></tr></table></figure>

<h3 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf apache-hive-1.2.1-bin.tar.gz -C /opt/module/</span><br><span class="line">mv apache-hive-1.2.1-bin/ hive</span><br><span class="line">mv hive-env.sh.template hive-env.sh</span><br><span class="line"><span class="comment"># export HADOOP_HOME=/opt/module/hadoop-2.7.2</span></span><br><span class="line"><span class="comment"># export HIVE_CONF_DIR=/opt/module/hive/conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在HDFS上创建/tmp和/user/hive/warehouse两个目录并修改他们的同组权限可写</span></span><br><span class="line">bin/hadoop fs -mkdir /tmp</span><br><span class="line">bin/hadoop fs -mkdir -p /user/hive/warehouse</span><br><span class="line">bin/hadoop fs -chmod g+w /tmp</span><br><span class="line">bin/hadoop fs -chmod g+w /user/hive/warehouse</span><br></pre></td></tr></table></figure>

<p><strong>Hive元数据配置到MySQL</strong></p>
<ul>
<li>如果MySQL配置了HA，需要更改hive-site.xml中javax.jdo.option.ConnectionURL为虚拟ip</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 拷贝驱动</span></span><br><span class="line">tar -zxvf mysql-connector-java-5.1.27.tar.gz</span><br><span class="line">cp mysql-connector-java-5.1.27-bin.jar /opt/module/hive/lib/</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置Metastore到MySQL</span></span><br><span class="line"><span class="comment"># /opt/module/hive/conf目录下创建一个hive-site.xml</span></span><br><span class="line">touch hive-site.xml</span><br><span class="line">vi hive-site.xml</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">mv hive-log4j.properties.template hive-log4j.properties</span><br><span class="line">vim hive-log4j.properties</span><br><span class="line"><span class="comment"># hive.log.dir=/opt/module/hive/logs</span></span><br></pre></td></tr></table></figure>

<p>根据官方文档配置参数<br><a href="https://cwiki.apache.org/confluence/display/Hive/AdminManual+MetastoreAdmin" target="_blank" rel="noopener">官方文档参数</a><br><a href="../../Configuration/Hive/hive-site.xml"><strong>hive-site.xml</strong></a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hiveserver2</span><br><span class="line">beeline</span><br><span class="line"><span class="comment"># !connect jdbc:hive2://hadoop102:10000</span></span><br></pre></td></tr></table></figure>

<h3 id="Tez"><a href="#Tez" class="headerlink" title="Tez"></a>Tez</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf apache-tez-0.9.1-bin.tar.gz -C /opt/module/</span><br><span class="line">mv apache-tez-0.9.1-bin/ tez-0.9.1</span><br><span class="line"><span class="comment"># Hive配置Tez</span></span><br><span class="line">vim hive-env.sh</span><br><span class="line">vim hive-site.xml</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Set HADOOP_HOME to point to a specific hadoop install directory</span></span><br><span class="line"><span class="attr">export</span> <span class="string">HADOOP_HOME=/opt/module/hadoop-2.7.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hive Configuration Directory can be controlled by:</span></span><br><span class="line"><span class="attr">export</span> <span class="string">HIVE_CONF_DIR=/opt/module/hive/conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Folder containing extra libraries required for hive compilation/execution can be controlled by:</span></span><br><span class="line"><span class="attr">export</span> <span class="string">TEZ_HOME=/opt/module/tez-0.9.1    #是你的tez的解压目录</span></span><br><span class="line"><span class="attr">export</span> <span class="string">TEZ_JARS=""</span></span><br><span class="line"><span class="attr">for</span> <span class="string">jar in `ls $TEZ_HOME |grep jar`; do</span></span><br><span class="line">    <span class="attr">export</span> <span class="string">TEZ_JARS=$TEZ_JARS:$TEZ_HOME/$jar</span></span><br><span class="line"><span class="attr">done</span></span><br><span class="line"><span class="attr">for</span> <span class="string">jar in `ls $TEZ_HOME/lib`; do</span></span><br><span class="line">    <span class="attr">export</span> <span class="string">TEZ_JARS=$TEZ_JARS:$TEZ_HOME/lib/$jar</span></span><br><span class="line"><span class="attr">done</span></span><br><span class="line"></span><br><span class="line"><span class="attr">export</span> <span class="string">HIVE_AUX_JARS_PATH=/opt/module/hadoop-2.7.2/share/hadoop/common/hadoop-lzo-0.4.20.jar$TEZ_JARS</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.execution.engine<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>tez<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>/opt/module/hive/conf目录下添加<a href="../../Configuration/tez-site.xml"><strong>tez-site.xml</strong></a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim <span class="variable">$HADOOP_HOME</span>/etc/hadoop/yarn-site.xml</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 关闭内存检查防止杀进程 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 上传tez到HDFS</span></span><br><span class="line">hadoop fs -mkdir /tez</span><br><span class="line">hadoop fs -put /opt/module/tez-0.9.1/ /tez</span><br><span class="line">hadoop fs -ls /tez /tez/tez-0.9.1</span><br><span class="line"><span class="comment"># 启动hive测试</span></span><br><span class="line">hive</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="keyword">string</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">"lisi"</span>);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure>


<h3 id="Spark"><a href="#Spark" class="headerlink" title="Spark"></a>Spark</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf spark-2.1.1-bin-hadoop2.7.tgz -C /opt/module/</span><br><span class="line">mv spark-2.1.1-bin-hadoop2.7 spark-local</span><br><span class="line"><span class="comment"># 官方迭代求π案例</span></span><br><span class="line">bin/spark-submit \</span><br><span class="line">--class org.apache.spark.examples.SparkPi \</span><br><span class="line">--executor-memory 1G \</span><br><span class="line">--total-executor-cores 2 \</span><br><span class="line">./examples/jars/spark-examples_2.11-2.1.1.jar \</span><br><span class="line">100</span><br><span class="line"><span class="comment"># 另一种写法</span></span><br><span class="line">bin/spark-submit \</span><br><span class="line">--class org.apache.spark.examples.SparkPi \</span><br><span class="line">--master <span class="built_in">local</span>[2] \</span><br><span class="line">./examples/jars/spark-examples_2.11-2.1.1.jar 100</span><br><span class="line"><span class="comment"># zsh需要把local[2]加上引号:'local[2]'</span></span><br><span class="line"><span class="comment"># 快捷方式</span></span><br><span class="line">bin/run-example SparkPi 100</span><br></pre></td></tr></table></figure>


<h3 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h3><h3 id="Canal"><a href="#Canal" class="headerlink" title="Canal"></a>Canal</h3><h3 id="Phoenix"><a href="#Phoenix" class="headerlink" title="Phoenix"></a>Phoenix</h3><h3 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf flink-1.7.2-bin-hadoop27-scala_2.11.tgz ../module</span><br><span class="line">vim conf/flink-conf.yaml</span><br><span class="line">vim conf/slave</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">jpbmanager.rpc.address</span>: <span class="string">hadoop102</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br></pre></td></tr></table></figure>

<p><a href="http://localhost:8081" target="_blank" rel="noopener">Flink Web页面</a></p>
<h3 id="Sqoop"><a href="#Sqoop" class="headerlink" title="Sqoop"></a>Sqoop</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxf sqoop-1.4.6.bin__hadoop-2.0.4-alpha.tar.gz -C /opt/module/</span><br><span class="line">mv sqoop-1.4.6.bin__hadoop-2.0.4-alpha/ sqoop/</span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile <span class="comment"># 配置环境变量</span></span><br><span class="line">mv sqoop-env-template.sh sqoop-env.sh</span><br><span class="line">vim sqoop-env.sh <span class="comment"># 添加下述配置</span></span><br><span class="line"><span class="comment"># 拷贝MySQL驱动到lib</span></span><br><span class="line">cp mysql-connector-java-5.1.27-bin.jar /opt/module/sqoop/lib/</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export HADOOP_COMMON_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;hadoop-2.7.2</span><br><span class="line">export HADOOP_MAPRED_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;hadoop-2.7.2</span><br><span class="line">export HIVE_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;hive</span><br><span class="line">export ZOOKEEPER_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;zookeeper</span><br><span class="line">export ZOOCFGDIR&#x3D;&#x2F;opt&#x2F;module&#x2F;zookeeper&#x2F;conf</span><br><span class="line">export HBASE_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;hbase</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 验证Sqoop</span></span><br><span class="line">bin/sqoop <span class="built_in">help</span></span><br><span class="line"><span class="comment"># Available commands:</span></span><br><span class="line"><span class="comment">#   codegen            Generate code to interact with database records</span></span><br><span class="line"><span class="comment">#   create-hive-table     Import a table definition into Hive</span></span><br><span class="line"><span class="comment">#   eval               Evaluate a SQL statement and display the results</span></span><br><span class="line"><span class="comment">#   export             Export an HDFS directory to a database table</span></span><br><span class="line"><span class="comment">#   help               List available commands</span></span><br><span class="line"><span class="comment">#   import             Import a table from a database to HDFS</span></span><br><span class="line"><span class="comment">#   import-all-tables     Import tables from a database to HDFS</span></span><br><span class="line"><span class="comment">#   import-mainframe    Import datasets from a mainframe server to HDFS</span></span><br><span class="line"><span class="comment">#   job                Work with saved jobs</span></span><br><span class="line"><span class="comment">#   list-databases        List available databases on a server</span></span><br><span class="line"><span class="comment">#   list-tables           List available tables in a database</span></span><br><span class="line"><span class="comment">#   merge              Merge results of incremental imports</span></span><br><span class="line"><span class="comment">#   metastore           Run a standalone Sqoop metastore</span></span><br><span class="line"><span class="comment">#   version            Display version information</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 测试Sqoop是否能够成功连接数据库</span></span><br><span class="line">bin/sqoop list-databases --connect jdbc:mysql://hadoop102:3306/ --username root --password root</span><br><span class="line"><span class="comment"># information_schema</span></span><br><span class="line"><span class="comment"># metastore</span></span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line"><span class="comment"># oozie</span></span><br><span class="line"><span class="comment"># performance_schema</span></span><br></pre></td></tr></table></figure>


<h3 id="Azkaban"><a href="#Azkaban" class="headerlink" title="Azkaban"></a>Azkaban</h3><p><a href="http://azkaban.github.io/downloads.html" target="_blank" rel="noopener">==<strong>下载地址</strong>==</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir /opt/module/azkaban</span><br><span class="line">tar -zxvf azkaban-web-server-2.5.0.tar.gz -C /opt/module/azkaban/</span><br><span class="line">tar -zxvf azkaban-executor-server-2.5.0.tar.gz -C /opt/module/azkaban/</span><br><span class="line">tar -zxvf azkaban-sql-script-2.5.0.tar.gz -C /opt/module/azkaban/</span><br><span class="line">mv azkaban-web-2.5.0/ server</span><br><span class="line">mv azkaban-executor-2.5.0/ executor</span><br><span class="line">mysql -uroot -proot <span class="comment"># 建表</span></span><br><span class="line">keytool -keystore keystore -<span class="built_in">alias</span> jetty -genkey -keyalg RSA <span class="comment"># 生成密钥和整数</span></span><br><span class="line">tzselect <span class="comment"># 同步时间</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> azkaban;</span><br><span class="line"><span class="keyword">use</span> azkaban;</span><br><span class="line">source /opt/module/azkaban/azkaban-2.5.0/<span class="keyword">create</span>-<span class="keyword">all</span>-<span class="keyword">sql</span><span class="number">-2.5</span><span class="number">.0</span>.sql;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Web Server 配置</span></span><br><span class="line">vim /opt/module/azkaban/server/conf/azkaban.properties</span><br><span class="line">vim /opt/module/azkaban/server/conf/azkaban-users.xml</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#默认web server存放web文件的目录</span></span><br><span class="line"><span class="meta">web.resource.dir</span>=<span class="string">/opt/module/azkaban/server/web/</span></span><br><span class="line"><span class="comment">#默认时区,已改为亚洲/上海 默认为美国</span></span><br><span class="line"><span class="meta">default.timezone.id</span>=<span class="string">Asia/Shanghai</span></span><br><span class="line"><span class="comment">#用户权限管理默认类（绝对路径）</span></span><br><span class="line"><span class="meta">user.manager.xml.file</span>=<span class="string">/opt/module/azkaban/server/conf/azkaban-users.xml</span></span><br><span class="line"><span class="comment">#global配置文件所在位置（绝对路径）</span></span><br><span class="line"><span class="meta">executor.global.properties</span>=<span class="string">/opt/module/azkaban/executor/conf/global.properties</span></span><br><span class="line"><span class="comment">#数据库连接IP</span></span><br><span class="line"><span class="meta">mysql.host</span>=<span class="string">hadoop101</span></span><br><span class="line"><span class="comment">#数据库用户名</span></span><br><span class="line"><span class="meta">mysql.user</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#数据库密码</span></span><br><span class="line"><span class="meta">mysql.password</span>=<span class="string">000000</span></span><br><span class="line"><span class="comment">#SSL文件名（绝对路径）</span></span><br><span class="line"><span class="meta">jetty.keystore</span>=<span class="string">/opt/module/azkaban/server/keystore</span></span><br><span class="line"><span class="comment">#SSL文件密码</span></span><br><span class="line"><span class="meta">jetty.password</span>=<span class="string">000000</span></span><br><span class="line"><span class="comment">#Jetty主密码与keystore文件相同</span></span><br><span class="line"><span class="meta">jetty.keypassword</span>=<span class="string">000000</span></span><br><span class="line"><span class="comment">#SSL文件名（绝对路径）</span></span><br><span class="line"><span class="meta">jetty.truststore</span>=<span class="string">/opt/module/azkaban/server/keystore</span></span><br><span class="line"><span class="comment">#SSL文件密码</span></span><br><span class="line"><span class="meta">jetty.trustpassword</span>=<span class="string">000000</span></span><br><span class="line"><span class="comment"># mial settings</span></span><br><span class="line"><span class="meta">mail.sender</span>=<span class="string">Tiankx1003@gmial.com</span></span><br><span class="line"><span class="meta">mail.host</span>= <span class="string">stmp.gmail.com</span></span><br><span class="line"><span class="meta">mail.user</span>=<span class="string">Tiankx1003@gmail.com</span></span><br><span class="line"><span class="meta">mail.password</span>=<span class="string">Tt181024</span></span><br><span class="line"><span class="comment"># web 配置</span></span><br><span class="line"><span class="meta">job.failure.email</span>= <span class="string"></span></span><br><span class="line"><span class="comment"># web 配置</span></span><br><span class="line"><span class="meta">joa.success.email</span>=<span class="string"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">azkaban-users</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"azkaban"</span> <span class="attr">password</span>=<span class="string">"azkaban"</span> <span class="attr">roles</span>=<span class="string">"admin"</span> <span class="attr">groups</span>=<span class="string">"azkaban"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"metrics"</span> <span class="attr">password</span>=<span class="string">"metrics"</span> <span class="attr">roles</span>=<span class="string">"metrics"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin"</span> <span class="attr">roles</span>=<span class="string">"admin,metrics"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">role</span> <span class="attr">name</span>=<span class="string">"admin"</span> <span class="attr">permissions</span>=<span class="string">"ADMIN"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">role</span> <span class="attr">name</span>=<span class="string">"metrics"</span> <span class="attr">permissions</span>=<span class="string">"METRICS"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">azkaban-users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Executor Server 配置</span></span><br><span class="line">vim /opt/module/azkaban/server/conf/azkaban.properties</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#时区</span></span><br><span class="line"><span class="meta">default.timezone.id</span>=<span class="string">Asia/Shanghai</span></span><br><span class="line"><span class="meta">executor.global.properties</span>=<span class="string">/opt/module/azkaban/executor/conf/global.properties</span></span><br><span class="line"><span class="meta">mysql.host</span>=<span class="string">hadoop101</span></span><br><span class="line"><span class="meta">mysql.database</span>=<span class="string">azkaban</span></span><br><span class="line"><span class="meta">mysql.user</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">mysql.password</span>=<span class="string">000000</span></span><br></pre></td></tr></table></figure>

<p>先启动executor在执行web，避免web server因为找不到executor启动失败</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/azkaban-executor-start.sh <span class="comment"># executor</span></span><br><span class="line">bin/azkaban-web-start.sh <span class="comment"># server</span></span><br><span class="line">jps</span><br><span class="line">bin/azkaban-executor-shutdown.sh</span><br><span class="line">bin/azkaban-web-shutdown.sh</span><br></pre></td></tr></table></figure>

<p><a href="hattps://hadoop101:8443">==<strong>Web页面查看 https://hadoop101:8443</strong>==</a></p>
<h3 id="Oozie"><a href="#Oozie" class="headerlink" title="Oozie"></a>Oozie</h3><h3 id="Presto"><a href="#Presto" class="headerlink" title="Presto"></a>Presto</h3><p><strong>Presto Server</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf presto-server-0.196.tar.gz -C /opt/module/</span><br><span class="line">mv presto-server-0.196/ presto</span><br><span class="line"><span class="comment"># 在presto目录下创建存储数据文件夹和存储配置文件文件夹</span></span><br><span class="line">mkdir data</span><br><span class="line">mkdir etc</span><br><span class="line"><span class="comment"># etc/下添加jvm.configh文件和catalog目录</span></span><br><span class="line">vim jvm.config</span><br><span class="line"><span class="comment"># 在catalog目录下创建hive.properties文件</span></span><br><span class="line">vim properties</span><br><span class="line">xsync /opt/module/presto <span class="comment"># 分发</span></span><br><span class="line"><span class="comment"># 每个节点配置/opt/module/presto/etc/node.properties</span></span><br><span class="line">xcall vim /opt/module/presto/etc/node.properties</span><br><span class="line"><span class="comment"># hadoop102配置coordinator节点，其他配置worker节点</span></span><br><span class="line">xcall vim /opt/module/presto/etc/config.properties</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-server</span><br><span class="line">-Xmx16G</span><br><span class="line">-XX:+UseG1GC</span><br><span class="line">-XX:G1HeapRegionSize&#x3D;32M</span><br><span class="line">-XX:+UseGCOverheadLimit</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrent</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line">-XX:+ExitOnOutOfMemoryError</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">connector.name</span>=<span class="string">hive-hadoop2</span></span><br><span class="line"><span class="meta">hive.metastore.uri</span>=<span class="string">thrift://hadoop102:9083</span></span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hadoop102</span></span><br><span class="line"><span class="meta">node.environment</span>=<span class="string">production</span></span><br><span class="line"><span class="meta">node.id</span>=<span class="string">ffffffff-ffff-ffff-ffff-ffffffffffff</span></span><br><span class="line"><span class="meta">node.data-dir</span>=<span class="string">/opt/module/presto/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hadoop103</span></span><br><span class="line"><span class="meta">node.environment</span>=<span class="string">production</span></span><br><span class="line"><span class="meta">node.id</span>=<span class="string">ffffffff-ffff-ffff-ffff-fffffffffffe</span></span><br><span class="line"><span class="meta">node.data-dir</span>=<span class="string">/opt/module/presto/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hadoop104</span></span><br><span class="line"><span class="meta">node.environment</span>=<span class="string">production</span></span><br><span class="line"><span class="meta">node.id</span>=<span class="string">ffffffff-ffff-ffff-ffff-fffffffffffd</span></span><br><span class="line"><span class="meta">node.data-dir</span>=<span class="string">/opt/module/presto/data</span></span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hadoop102</span></span><br><span class="line"><span class="attr">coordinator</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">node-scheduler.include-coordinator</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">http-server.http.port</span>=<span class="string">8881</span></span><br><span class="line"><span class="meta">query.max-memory</span>=<span class="string">50GB</span></span><br><span class="line"><span class="meta">discovery-server.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">discovery.uri</span>=<span class="string">http://hadoop102:8881</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hadoop103</span></span><br><span class="line"><span class="attr">coordinator</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">http-server.http.port</span>=<span class="string">8881</span></span><br><span class="line"><span class="meta">query.max-memory</span>=<span class="string">50GB</span></span><br><span class="line"><span class="meta">discovery.uri</span>=<span class="string">http://hadoop102:8881</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hadoop104</span></span><br><span class="line"><span class="attr">coordinator</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">http-server.http.port</span>=<span class="string">8881</span></span><br><span class="line"><span class="meta">query.max-memory</span>=<span class="string">50GB</span></span><br><span class="line"><span class="meta">discovery.uri</span>=<span class="string">http://hadoop102:8881</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 前台启动Presto控制台显示日志</span></span><br><span class="line">xcall /opt/module/presto/launcher run</span><br><span class="line"><span class="comment"># 后台启动Presto</span></span><br><span class="line">xcall /opt/module/presto/launcher start</span><br><span class="line"><span class="comment"># 日志查看路径/opt/module/presto/data/var/log</span></span><br></pre></td></tr></table></figure>

<p><strong>Presto Client</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 上传presto-cli-0.196-executable.jar至/opt/module/presto</span></span><br><span class="line"><span class="comment"># 修改文件名并增加执行权限</span></span><br><span class="line">mv presto-cli-0.196-executable.jar  prestocli</span><br><span class="line">chmod +x prestocli</span><br><span class="line"><span class="comment"># 启动prestocli</span></span><br><span class="line">./prestocli --server hadoop102:8881 --catalog hive --schema default</span><br></pre></td></tr></table></figure>
<ul>
<li>Presto命令行操作相当于hive命令行操作，每个表必须加上schema，如<code>select * from schema.table limit 100</code></li>
</ul>
<p><strong>Presto 可视化Client</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 上传yanagishima-18.0.zip至module并解压</span></span><br><span class="line">unzip yanagishima-18.0.zip</span><br><span class="line"><span class="built_in">cd</span> yanagishima-18.0</span><br><span class="line"><span class="comment"># /opt/module/yanagishima-18.0/conf下编辑yanagishima.properties</span></span><br><span class="line">vim yanagishima.properties</span><br><span class="line"><span class="comment"># /opt/module/yanagishima-18.0/下启动yanagishima-18.0</span></span><br><span class="line">nohup bin/yanagishima-start.sh &gt;y.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">jetty.port</span>=<span class="string">7080</span></span><br><span class="line"><span class="meta">presto.datasources</span>=<span class="string">atiguigu-presto</span></span><br><span class="line"><span class="meta">presto.coordinator.server.atiguigu-presto</span>=<span class="string">http://hadoop102:8881</span></span><br><span class="line"><span class="meta">catalog.atiguigu-presto</span>=<span class="string">hive</span></span><br><span class="line"><span class="meta">schema.atiguigu-presto</span>=<span class="string">default</span></span><br><span class="line"><span class="meta">sql.query.engines</span>=<span class="string">presto</span></span><br></pre></td></tr></table></figure>
<p>查看Web页面<a href="http://hadoop102:7080" target="_blank" rel="noopener">http://hadoop102:7080</a></p>
<h3 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a>Druid</h3><h3 id="Impala"><a href="#Impala" class="headerlink" title="Impala"></a>Impala</h3><h3 id="Kylin"><a href="#Kylin" class="headerlink" title="Kylin"></a>Kylin</h3><p><a href="http://kylin.apache.org/cn/" target="_blank" rel="noopener"><strong>官网地址</strong>http://kylin.apache.org/cn/</a><br><a href="http://kylin.apache.org/cn/docs/" target="_blank" rel="noopener"><strong>官方文档</strong>http://kylin.apache.org/cn/docs/</a><br><a href="http://kylin.apache.org/cn/download/" target="_blank" rel="noopener"><strong>下载地址</strong>http://kylin.apache.org/cn/download/</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -zxvf apache-kylin-2.5.1-bin-hbase1x.tar.gz -C /opt/module/</span><br><span class="line"><span class="comment"># 使用Kylin需要配置HADOOP_HOME,HIVE_HOME,HBASE_HOME，并添加PATH</span></span><br><span class="line"><span class="comment"># 先启动hdsf,yarn,historyserver,zk,hbase</span></span><br><span class="line">start-dfs.sh <span class="comment"># hadoop101</span></span><br><span class="line">start-yarn.sh <span class="comment"># hadoop102</span></span><br><span class="line">mr-jobhistoryserver.sh start historyserver <span class="comment"># hadoop101</span></span><br><span class="line">start-zk <span class="comment"># shell</span></span><br><span class="line">start-hbase.sh</span><br><span class="line">jpsall <span class="comment"># 查看所有进程</span></span><br><span class="line"><span class="comment"># --------------------- hadoop101 ----------------</span></span><br><span class="line"><span class="comment"># 3360 JobHistoryServer</span></span><br><span class="line"><span class="comment"># 31425 HMaster</span></span><br><span class="line"><span class="comment"># 3282 NodeManager</span></span><br><span class="line"><span class="comment"># 3026 DataNode</span></span><br><span class="line"><span class="comment"># 53283 Jps</span></span><br><span class="line"><span class="comment"># 2886 NameNode</span></span><br><span class="line"><span class="comment"># 44007 RunJar</span></span><br><span class="line"><span class="comment"># 2728 QuorumPeerMain</span></span><br><span class="line"><span class="comment"># 31566 HRegionServer</span></span><br><span class="line"><span class="comment"># --------------------- hadoop102 ----------------</span></span><br><span class="line"><span class="comment"># 5040 HMaster</span></span><br><span class="line"><span class="comment"># 2864 ResourceManager</span></span><br><span class="line"><span class="comment"># 9729 Jps</span></span><br><span class="line"><span class="comment"># 2657 QuorumPeerMain</span></span><br><span class="line"><span class="comment"># 4946 HRegionServer</span></span><br><span class="line"><span class="comment"># 2979 NodeManager</span></span><br><span class="line"><span class="comment"># 2727 DataNode</span></span><br><span class="line"><span class="comment"># --------------------- hadoop103 ----------------</span></span><br><span class="line"><span class="comment"># 4688 HRegionServer</span></span><br><span class="line"><span class="comment"># 2900 NodeManager</span></span><br><span class="line"><span class="comment"># 9848 Jps</span></span><br><span class="line"><span class="comment"># 2636 QuorumPeerMain</span></span><br><span class="line"><span class="comment"># 2700 DataNode</span></span><br><span class="line"><span class="comment"># 2815 SecondaryNameNode</span></span><br></pre></td></tr></table></figure>
<p><a href="http://hadoop101:7070/kylin/" target="_blank" rel="noopener"><strong>Web页面</strong>http://hadoop101:7070/kylin/</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Tiankx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://tiankx1003.github.io/2020/07/26/DW-Build/">http://tiankx1003.github.io/2020/07/26/DW-Build/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/BigData/">BigData</a><a class="post-meta__tags" href="/tags/Data-Warehouse/">Data-Warehouse</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/aliPay.jpg"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/WeChatPay.jpg"><div class="post-qr-code__desc">微信打赏</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/07/26/Flink--CEP/"><i class="fa fa-chevron-left">  </i><span>Flink--复杂事件处理(CEP)</span></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '92790026f331d18e4b34',
  clientSecret: '178a65c6e00605cff8e87083ee818aa41cfdf013',
  repo: 'tiankx1003.github.io',
  owner: 'tiankx1003',
  admin: 'tiankx1003',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(/img/bg.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2012 - 2021 By Tiankx</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://github.com/Tianxk1003" target="_blank" rel="noopener">blog</a>!</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>